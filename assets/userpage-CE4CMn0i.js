import{_ as D,r as c,C as k,u as I,b as T,D as _,e as r,f as i,w as a,h as g,g as l,V as f,l as v,E as U,F as z,t as C,p as V,G as L,x as P,m as N,H as M,I as R,J as G,z as $,K as H,k as b,L as J,v as K,A as O,M as q,B as Q}from"./index-CyV538c9.js";import{u as W,P as X}from"./PostCard-BCWDmYXA.js";import{z as Y}from"./vue-boring-avatars-f75Qd4DN.js";import{b as F}from"./route-block-B_A1xBdJ.js";const Z={class:"ma-8"},w=16,S={__name:"userpage",setup(ee){const{api:A}=Q(),d=c(1),B=k(()=>Math.ceil(o.value.length/w)),m=I(),x=W(),n=T();console.log("🛑 route.params:",n.params);const p=c(!1),y=c(null),o=c([]),E=c(""),s=c("created"),h=k(()=>o.value.filter(e=>(console.log("📝 文章:",e),s.value==="created"?e.user.toString()===n.params.id:x.collectedPosts.includes(e._id))).filter(e=>e.title.toLowerCase().includes(E.value.toLowerCase())).slice((d.value-1)*w,d.value*w)),j=async()=>{if(console.log("route.params.id:",n.params.id),!n.params.id){console.error("❌ 無法獲取用戶 ID，請確認用戶是否已正確進入頁面");return}if(!p.value){p.value=!0,y.value=null;try{const t=s.value==="created"?"/post/userposts/"+n.params.id:"/userCollect/collected/"+n.params.id;console.log("🚀 API 請求路徑:",t);const{data:e}=await A.get(t);if(!(e!=null&&e.result))throw new Error("無效的回應格式");o.value=e.result,console.log("✅ 獲取的文章:",o.value)}catch(t){console.error("❌ 獲取文章失敗:",t),t.value="無法取得文章資料",o.value=[]}finally{p.value=!1}}};return _(s,()=>{d.value=1,j()}),_(()=>x.collectedPosts,t=>{console.log("收藏的文章更新:",t)},{deep:!0,immediate:!0}),_(o,t=>{console.log("posts 更新:",t)}),(async()=>{try{const t=await x.fetchCollectedPosts();console.log("收藏的文章:",t)}catch(t){console.error("獲取文章失敗:",t),t.value="無法取得文章資料",o.value=[]}})(),(t,e)=>(r(),i(O,{style:{"margin-top":"50px"}},{default:a(()=>[g("div",Z,[l(P,{class:"d-flex justify-center align-center text-snow"},{default:a(()=>[l(f,{cols:"2"},{default:a(()=>[l(v(Y),{size:200,variant:"beam",name:v(m).account,title:!0,style:{"margin-right":"10px"}},null,8,["name"])]),_:1}),l(f,{cols:"6",style:{"margin-left":"50px"},class:"text-snow"},{default:a(()=>[l(U,{variant:"text",class:"d-flex flex-column text-h5 content"},{default:a(()=>[l(z,{style:{"margin-top":"10px"},class:"usrAccount"},{default:a(()=>[g("h2",null,C(v(m).account),1),l(V,{icon:"mdi-pencil",variant:"text",class:"text-snow"})]),_:1}),l(L,null,{default:a(()=>[g("p",null,C(v(m).introduce),1)]),_:1})]),_:1})]),_:1}),l(f,{cols:"12",class:"d-flex justify-center align-center"},{default:a(()=>[l(V,{text:"已建立",class:"text-body-2 me-4 font-weight-bold rounded-lg",variant:s.value==="created"?"flat":"outlined",color:(s.value==="created","#F1D87F"),onClick:e[0]||(e[0]=u=>s.value="created")},null,8,["variant","color"]),l(V,{text:"已收藏",class:"text-body-2 ms-4 font-weight-bold rounded-lg",variant:s.value==="favorite"?"flat":"outlined",color:(s.value==="favorite","#C04759"),onClick:e[1]||(e[1]=u=>s.value="favorite")},null,8,["variant","color"])]),_:1})]),_:1}),h.value.length>0?(r(),i(P,{key:0,class:"d-flex justify-center"},{default:a(()=>[(r(!0),N(R,null,M(h.value,u=>(r(),i(f,{key:u.id,cols:"12",md:"6",lg:"3",class:"mt-4"},{default:a(()=>[l(X,q({ref_for:!0},u,{account:v(m).account}),null,16,["account"])]),_:2},1024))),128)),l(f,{cols:"12"},{default:a(()=>[l(G,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=u=>d.value=u),length:B.value},null,8,["modelValue","length"])]),_:1})]),_:1})):(r(),i(P,{key:1,class:"d-flex justify-center text-center text-snow text-body-2"},{default:a(()=>e[3]||(e[3]=[g("p",null," 尚無文章 ",-1)])),_:1}))]),p.value?(r(),i($,{key:0,class:"d-flex align-center justify-center"},{default:a(()=>[l(H,{indeterminate:""})]),_:1})):b("",!0),y.value?(r(),i(J,{key:1,type:"error",variant:"tonal",class:"ma-4"},{default:a(()=>[K(C(y.value),1)]),_:1})):b("",!0)]),_:1}))}};typeof F=="function"&&F(S);const re=D(S,[["__scopeId","data-v-71b1faf1"]]);export{re as default};
