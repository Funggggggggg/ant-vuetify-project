import{a3 as b,u as y,A as S,z as _,_ as L,k as z,l as I,c as C,r as B,o as F,j as M,w as s,p as x,b as t,g as N,t as d,$ as A,H as D,D as T,E as v,M as $,s as p,a0 as E,a6 as R,a1 as U,an as j,N as H,L as q}from"./index-DKuFUKrB.js";import{z as G}from"./vue-boring-avatars-BxDa2gtD.js";const J=b("userCollect",()=>{const{apiAuth:o}=_(),g=y(),c=S([]);return{collectedPosts:c,fetchCollectedPosts:async()=>{if(g.isLoggedIn)try{const{data:e}=await o.get("/userCollect/collected");c.value=e.result||[]}catch(e){console.error("獲取收藏文章失敗:",e)}},toggleCollectPost:async e=>{if(!g.isLoggedIn)throw new Error("用戶未登入");try{const{data:r}=await o.patch("/userCollect/uncollected",{post:e});c.value=r.result||[]}catch(r){throw console.error("更新收藏狀態失敗:",r),r}}}}),K={class:"d-flex align-center mb-4"},O={class:"ms-4"},Q={__name:"PostCard",props:{_id:{type:String,default:""},account:{type:String,default:""},title:{type:String,default:""},like:{type:Boolean,default:!1},image:{type:String,default:""},content:{type:String,default:""},category:{type:String,default:""}},setup(o){const{apiAuth:g}=_(),c=y(),i=J(),h=z(),e=S(!1),r=I(),a=o,m=C(()=>!c.isLoggedIn||!i.collectedPosts?!1:i.collectedPosts.some(u=>u.toString()===a._id.toString())),k=async u=>{var n,f;if(u.preventDefault(),!c.isLoggedIn){r.push("/login");return}try{const{data:l}=await g.patch("/userCollect/uncollect",{post:a._id});if(l.success){await i.fetchCollectedPosts();const P=i.collectedPosts.some(V=>V.post.toString()===a._id.toString());h({text:P?"成功加入收藏":"已取消收藏",snackbarProps:{color:"#3B6C73"}})}}catch(l){console.log("收藏操作失敗:",l),h({text:"api."+(((f=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:f.message)||"操作失敗"),snackbarProps:{color:"#C04759"}})}},w=C(()=>a.content.length>40?a.content.slice(0,40)+"...":a.content);return(u,n)=>{const f=B("router-link");return F(),M(q,{class:"card text-abril",onMouseenter:n[0]||(n[0]=l=>e.value=!0),onMouseleave:n[1]||(n[1]=l=>e.value=!1)},{default:s(()=>[x("div",K,[t(N(G),{size:30,variant:"beam",name:a.account,title:!0},null,8,["name"]),x("div",O,d(a.account),1)]),t(A,{class:D(["picMask",{hightlight:e.value}]),src:o.image,height:"200",cover:""},null,8,["class","src"]),t(T,{class:"info"},{default:s(()=>[t(v,{col:"9"},{default:s(()=>[t($,null,{default:s(()=>[t(f,{to:"/post/"+o._id,style:{"text-decoration":"none","font-weight":"500 !important"},class:"text-body-1 text-snow text-klee-one"},{default:s(()=>[p(d(o.title),1)]),_:1},8,["to"])]),_:1})]),_:1}),t(v,{cols:"3",class:"d-flex align-center"},{default:s(()=>[t(E,{style:R({color:m.value?"#C04759":"#F1D87F",fontSize:"25px",transition:"color 0.3s ease"}),left:"",class:"ms-1",onClick:U(k,["stop"])},{default:s(()=>[p(d(m.value?"mdi-heart":"mdi-heart-outline"),1)]),_:1},8,["style"])]),_:1})]),_:1}),t(j,{class:"subtitle text-klee-one"},{default:s(()=>[p(d(o.category),1)]),_:1}),t(H,{class:"content text-klee-one"},{default:s(()=>[p(d(w.value),1)]),_:1})]),_:1})}}},Y=L(Q,[["__scopeId","data-v-090125a7"]]);export{Y as P,J as u};
