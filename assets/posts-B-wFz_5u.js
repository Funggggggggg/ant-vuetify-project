import{k as Z,u as H,W as J,A as c,c as q,r as ee,o as S,a as ae,b as t,w as l,D as te,E as N,p as le,t as i,h as oe,U as se,X as re,v as x,s as d,Y as ne,G as h,Z as ue,j as _,$ as z,x as L,n as ie,K as de,g as r,a0 as ce,L as me,M as ve,N as pe,O as ge,P as fe,Q as Ve,R as be,S as ye,F as ke,z as xe}from"./index-BrPvT3NF.js";import{a as Ce,u as v}from"./vee-validate-g8Jfa14R.js";import{c as we,a as A,b as O}from"./index.esm-Yr44nOnA.js";import{b as j}from"./route-block-B_A1xBdJ.js";const Pe={__name:"posts",setup(Se){const{apiAuth:C}=xe(),p=Z(),g=H(),f=J([]),w=c(""),P=c(!1),E=c(null),I=q(()=>[{title:"標題",key:"title",sortable:!0},{title:"發布者",key:"account",sortable:!0},{title:"圖片",key:"image",sortable:!1},{title:"分類",key:"category",sortable:!0},{title:"說明",key:"content",sortable:!0},{title:"創建日期",key:"createdAt",sortable:!0},{title:"修改日期",key:"updatedAt",sortable:!0},{title:"私人",key:"isPrivate",sortable:!0},{title:"喜歡",key:"like",sortable:!0},{title:"編輯",key:"edit",sortable:!1}]),F=async()=>{var o,a;if(!P.value){P.value=!0,E.value=null;try{const{data:u}=await C.get("/post/all");f.push(...u.result)}catch(u){console.log(u),p({text:"api."+(((a=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:a.message)||"未知錯誤"),snackbarProps:{color:"#C04759"}})}finally{P.value=!1}}};F();const n=c({open:!1,id:""}),D=o=>{o?(n.value.id=o._id,B.value.value=g._id,V.value.value=o.title,b.value.value=o.content,y.value.value=o.category,k.value.value=o.isPrivate):B.value.value=g._id,n.value.open=!0},U=()=>{Q(),n.value.id="",n.value.open=!1,T.value.deleteFileRecord()},G=we({title:A().required("卡片標題必填").min(1,"標題過少").max(8,"標題過長"),content:A().required("卡片內容必填").min(10,"文字內容過少").max(300,"文字內容過長"),category:A().required("卡片分類必填").oneOf(["紀念繪畫","回憶拼貼","故事攝影","物品改造","其他"],"api.卡片分類不符"),isPrivate:O().default(!1).required("私人與否必填"),like:O().default(!1).notRequired()}),{handleSubmit:K,isSubmitting:M,resetForm:Q}=Ce({validationSchema:G,initialValues:{user:"",account:"",title:"",content:"",category:"紀念繪畫",isPrivate:!1,like:!1}}),V=v("title"),B=v("user"),b=v("content"),y=v("category"),k=v("isPrivate"),W=q(()=>[{text:"紀念繪畫",value:"紀念繪畫"},{text:"回憶拼貼",value:"回憶拼貼"},{text:"故事攝影",value:"故事攝影"},{text:"物品改造",value:"物品改造"},{text:"其他",value:"其他"}]),T=c(null),m=c([]),R=c([]),X=K(async o=>{var a,u,e;if(!((a=m.value[0])!=null&&a.error)){if(n.value.id.length===0&&m.value.length===0){p({text:"卡片圖片必填",snackbarProps:{color:"#C04759"}});return}try{const s=new FormData;s.append("user",g._id),s.append("account",g.account),s.append("title",o.title),s.append("content",o.content),s.append("category",o.category),s.append("isPrivate",o.isPrivate),m.value.length>0&&s.append("image",m.value[0].file);for(let $ of s.entries())console.log($[0]+", "+$[1]);n.value.id.length>0?await C.patch("/post/"+n.value.id,s):await C.post("/post",s),f.splice(0,f.length),F(),p({text:n.value.id.length>0?"編輯成功":"新增成功",snackbarProps:{color:"#3B6C73"}}),U()}catch(s){console.log(s),p({text:"api."+(((e=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:e.message)||"未知錯誤"),snackbarProps:{color:"#C04759"}})}}});function Y(o,a){return o.length>a?o.slice(0,a)+"...":o}return(o,a)=>{const u=ee("VueFileAgent");return S(),ae(ke,null,[t(ie,null,{default:l(()=>[t(te,null,{default:l(()=>[t(N,{cols:"12"},{default:l(()=>a[9]||(a[9]=[le("h1",{class:"text-center"},i("卡片管理"),-1)])),_:1}),t(oe),t(N,{cols:"12"},{default:l(()=>[t(se,{items:f,headers:I.value,search:w.value},{top:l(()=>[t(re,null,{default:l(()=>[t(x,{onClick:a[0]||(a[0]=e=>D(null))},{default:l(()=>a[10]||(a[10]=[d(i("新增"))])),_:1}),t(ne),t(h,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),"prepend-inner-icon":"mdi-magnify",variant:"underlined"},null,8,["modelValue"])]),_:1})]),"item.account":l(({value:e})=>[d(i(e),1)]),"item.image":l(({value:e})=>[t(ue,{src:e,width:"80"},null,8,["src"])]),"item.createdAt":l(({value:e})=>[d(i(new Date(e).toLocaleString()),1)]),"item.updatedAt":l(({value:e})=>[d(i(new Date(e).toLocaleString()),1)]),"item.category":l(({value:e})=>[d(i(e),1)]),"item.content":l(({value:e})=>[d(i(Y(e,30)),1)]),"item.isPrivate":l(({value:e})=>[e?(S(),_(z,{key:0,icon:"mdi-check"})):L("",!0)]),"item.like":l(({value:e})=>[e==="0"?(S(),_(z,{key:0,icon:"mdi-heart"})):L("",!0)]),"item.edit":l(({item:e})=>[t(x,{icon:"mdi-pencil",variant:"text",onClick:s=>D(e)},null,8,["onClick"])]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1}),t(ye,{modelValue:n.value.open,"onUpdate:modelValue":a[8]||(a[8]=e=>n.value.open=e),persistent:""},{default:l(()=>[t(de,{disabled:r(M),onSubmit:ce(r(X),["prevent"])},{default:l(()=>[t(me,null,{default:l(()=>[t(ve,{style:{margin:"10px"}},{default:l(()=>[d(i(n.value.id?"編輯卡片":"新增卡片"),1)]),_:1}),t(pe,null,{default:l(()=>[t(h,{modelValue:r(V).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r(V).value.value=e),label:"標題","error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(ge,{modelValue:r(y).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r(y).value.value=e),"error-messages":r(y).errorMessage.value,items:W.value,label:"分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),t(fe,{modelValue:r(b).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>r(b).value.value=e),label:"卡片說明","error-messages":r(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(u,{ref_key:"fileAgent",ref:T,modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e),"raw-model-value":R.value,"onUpdate:rawModelValue":a[6]||(a[6]=e=>R.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"]),t(Ve,{modelValue:r(k).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>r(k).value.value=e),label:"私人","error-messages":r(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(be,null,{default:l(()=>[t(x,{onClick:U},{default:l(()=>a[11]||(a[11]=[d(i("取消"))])),_:1}),t(x,{type:"submit",loading:r(M)},{default:l(()=>a[12]||(a[12]=[d(i("送出"))])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof j=="function"&&j(Pe);export{Pe as default};
