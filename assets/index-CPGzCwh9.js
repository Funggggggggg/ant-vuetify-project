import{_ as G,u as J,A as n,c as U,B as K,C as Q,r as Y,o as g,a as C,b as o,w as t,D as h,E as B,G as R,F as b,g as A,s as k,H as W,q as f,t as p,j as X,I as Z,n as ee,J as S,m as le,K as ae,L as oe,M as te,N as se,e as s,O as re,P as ne,Q as ue,R as ie,S as de,T as _,z as ve}from"./index-CfxNxlYg.js";import{P as ce}from"./PostCard-DSPC0dDT.js";import{u as i}from"./vee-validate-BYs27_nq.js";import"./vue-boring-avatars-DPYHVaZl.js";const me=4,L={__name:"index",setup(ge){const F=J(),{api:z}=ve(),V=n([]),x=n(""),u=n("全部"),j=["全部","紀念繪畫","回憶拼貼","故事攝影","物品改造","其他"];let y=!1;const N=U(()=>V.value.filter(l=>{const w=l.title.toLowerCase().includes(x.value.toLowerCase()),e=u.value==="全部"||l.category===u.value;return w&&e})),M=async()=>{if(!y){y=!0;try{const{data:a}=await z.get("/post",{params:{offset:V.value.length,limit:me}});a&&a.result?V.value.push(...a.result):console.error("無效的回應格式",a)}catch(a){console.log(a)}finally{y=!1}}},T=()=>{if(u.value!=="全部")return;const a=D.value;a&&a.getBoundingClientRect().top<=window.innerHeight&&(console.log("觸發加載更多文章"),M()),I.value=window.scrollY>300},D=n(null);K(()=>{window.addEventListener("scroll",T),M()}),Q(()=>{window.removeEventListener("scroll",T)});const I=n(!1),O=()=>{window.scrollTo({top:0,behavior:"smooth"})},r=n({open:!1,id:""}),E=n(null),d=i("title"),P=i("user"),v=i("content"),c=i("dialogcategory"),m=i("isPrivate"),H=U(()=>[{text:"紀念繪畫",value:"紀念繪畫"},{text:"回憶拼貼",value:"回憶拼貼"},{text:"故事攝影",value:"故事攝影"},{text:"物品改造",value:"物品改造"},{text:"其他",value:"其他"}]),$=a=>{a?(r.value.id=a._id,P.value.value=F.account,d.value.value=a.title,v.value.value=a.content,c.value.value=a.dialogcategory,m.value.value=a.isPrivate):P.value.value=F.account,r.value.open=!0},q=()=>{r.value.id="",r.value.open=!1,E.value.deleteFileRecord()};return(a,l)=>{const w=Y("VueFileAgent");return g(),C(b,null,[o(le,null,{default:t(()=>[o(h,{class:"d-flex justify-center",style:{width:"100%",gap:"5px","margin-top":"20px"}},{default:t(()=>[o(B,{cols:"12",class:"d-flex align-center justify-center",style:{height:"100px"}},{default:t(()=>[o(R,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),"prepend-inner-icon":"mdi-magnify",density:"comfortable","single-line":"",color:"#EDE5D2",class:"text-body-1 text-snow text-klee-one d-flex align-center me-4 search-bar"},null,8,["modelValue"]),(g(),C(b,null,A(j,e=>o(k,{key:e,class:W(["mx-2 text-body-2 ms-0 text-klee-one",{"v-btn--active":u.value===e}]),style:{"max-width":"500px","line-height":"5px",color:"#EDE5D2"},variant:"tonal",onClick:fe=>u.value=e},{default:t(()=>[f(p(e),1)]),_:2},1032,["class","onClick"])),64))]),_:1}),(g(!0),C(b,null,A(N.value,e=>(g(),X(B,{key:e._id,cols:"12",md:"6",lg:"3"},{default:t(()=>[o(ce,Z({ref_for:!0},e),null,16)]),_:2},1024))),128))]),_:1}),ee("div",{ref_key:"loadMoreTrigger",ref:D,class:"load-more-trigger"},null,512),o(S,{class:"ms-4 custom-fab-plus",icon:"mdi-plus",location:"top end",size:"x-large",color:"#F1D87F",variant:"outlined",onClick:l[1]||(l[1]=e=>$(a.item))}),o(S,{icon:"mdi-arrow-up",location:"bottom left",variant:"outlined",absolute:"",class:"custom-fab-up",style:{margin:"16px"},color:"#F1D87F",onClick:O})]),_:1}),o(de,{modelValue:r.value.open,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value.open=e),persistent:""},{default:t(()=>[o(ae,null,{default:t(()=>[o(oe,null,{default:t(()=>[o(te,{style:{margin:"10px"}},{default:t(()=>[f(p(r.value.id?"編輯卡片":"新增卡片"),1)]),_:1}),o(se,null,{default:t(()=>[o(R,{modelValue:s(d).value.value,"onUpdate:modelValue":l[2]||(l[2]=e=>s(d).value.value=e),label:"標題","error-messages":s(d).errorMessage.value},null,8,["modelValue","error-messages"]),o(re,{modelValue:s(c).value.value,"onUpdate:modelValue":l[3]||(l[3]=e=>s(c).value.value=e),"error-messages":s(c).errorMessage.value,items:H.value,label:"分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),o(ne,{modelValue:s(v).value.value,"onUpdate:modelValue":l[4]||(l[4]=e=>s(v).value.value=e),label:"卡片說明","error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"]),o(w,{ref_key:"fileAgent",ref:E,modelValue:a.fileRecords,"onUpdate:modelValue":l[5]||(l[5]=e=>a.fileRecords=e),"raw-model-value":a.rawFileRecords,"onUpdate:rawModelValue":l[6]||(l[6]=e=>a.rawFileRecords=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"]),o(ue,{modelValue:s(m).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>s(m).value.value=e),label:"私人","error-messages":s(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(ie,null,{default:t(()=>[o(k,{onClick:q},{default:t(()=>l[9]||(l[9]=[f(p("取消"))])),_:1}),o(k,null,{default:t(()=>l[10]||(l[10]=[f(p("送出"))])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof _=="function"&&_(L);const we=G(L,[["__scopeId","data-v-f12fee88"]]);export{we as default};
