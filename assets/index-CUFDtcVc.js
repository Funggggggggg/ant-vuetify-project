import{u as G,A as n,c as U,B as J,C as K,r as Q,o as p,a as b,b as t,w as o,D as Y,E as A,G as B,H as q,F as C,i as R,p as W,I as S,n as X,J as Z,K as ee,L as le,s as f,t as V,M as ae,g as s,N as te,O as oe,P as se,Q as re,v as F,R as ne,S as ue,j as ie,T as de,z as ve}from"./index-DditOydA.js";import{P as me}from"./PostCard-8jfaqA2X.js";import{u as d}from"./vee-validate-BpowkEoJ.js";import{b as L}from"./route-block-B_A1xBdJ.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-boring-avatars-HkrkFKsE.js";const ge=4,_={__name:"index",setup(pe){const k=G(),{api:z}=ve(),x=n([]),u=n(""),i=n("全部"),h=["全部","紀念繪畫","回憶拼貼","故事攝影","物品改造","其他"];let y=!1;const j=U(()=>x.value.filter(l=>{const w=l.title.toLowerCase().includes(u.value.toLowerCase()),e=i.value==="全部"||l.category===i.value;return w&&e})),M=async()=>{if(!y){y=!0;try{const{data:a}=await z.get("/post",{params:{offset:x.value.length,limit:ge}});a&&a.result?x.value.push(...a.result):console.error("無效的回應格式",a)}catch(a){console.log(a)}finally{y=!1}}},T=()=>{if(i.value!=="全部")return;const a=D.value;a&&a.getBoundingClientRect().top<=window.innerHeight&&(console.log("觸發加載更多文章"),M()),N.value=window.scrollY>300},D=n(null);J(()=>{window.addEventListener("scroll",T),M()}),K(()=>{window.removeEventListener("scroll",T)});const N=n(!1),I=()=>{window.scrollTo({top:0,behavior:"smooth"})},r=n({open:!1,id:""}),E=n(null),v=d("title"),P=d("user"),m=d("content"),c=d("dialogcategory"),g=d("isPrivate"),O=U(()=>[{text:"紀念繪畫",value:"紀念繪畫"},{text:"回憶拼貼",value:"回憶拼貼"},{text:"故事攝影",value:"故事攝影"},{text:"物品改造",value:"物品改造"},{text:"其他",value:"其他"}]),H=a=>{a?(r.value.id=a._id,P.value.value=k.account,v.value.value=a.title,m.value.value=a.content,c.value.value=a.dialogcategory,g.value.value=a.isPrivate):P.value.value=k.account,r.value.open=!0},$=()=>{r.value.id="",r.value.open=!1,E.value.deleteFileRecord()};return(a,l)=>{const w=Q("VueFileAgent");return p(),b(C,null,[t(X,null,{default:o(()=>[t(Y,{class:"d-flex justify-center",style:{width:"100%",gap:"5px","margin-top":"20px"}},{default:o(()=>[t(A,{cols:"12",class:"d-flex align-center justify-center",style:{height:"100px"}},{default:o(()=>[t(B,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),"prepend-inner-icon":"mdi-magnify",density:"comfortable","single-line":"",color:"#EDE5D2",style:q({width:u.value.length>0?"350px":"100px",transition:"width 0.3s ease-in-out",textAlign:"left",marginLeft:u.value.length>0?"20px":"0px"}),class:"text-body-1 text-snow d-flex align-center me-4 search-bar"},null,8,["modelValue","style"]),(p(),b(C,null,R(h,e=>t(F,{key:e,class:ue(["mx-2 text-body-2 ms-0",{"v-btn--active":i.value===e}]),style:{"max-width":"500px","line-height":"5px",color:"#EDE5D2"},variant:"tonal",onClick:fe=>i.value=e},{default:o(()=>[f(V(e),1)]),_:2},1032,["class","onClick"])),64))]),_:1}),(p(!0),b(C,null,R(j.value,e=>(p(),ie(A,{key:e._id,cols:"12",md:"6",lg:"3"},{default:o(()=>[t(me,de({ref_for:!0},e),null,16)]),_:2},1024))),128))]),_:1}),W("div",{ref_key:"loadMoreTrigger",ref:D,class:"load-more-trigger"},null,512),t(S,{class:"ms-4 custom-fab-plus",icon:"mdi-plus",location:"top end",size:"x-large",color:"#F1D87F",variant:"outlined",onClick:l[1]||(l[1]=e=>H(a.item))}),t(S,{icon:"mdi-arrow-up",location:"bottom left",variant:"outlined",absolute:"",class:"custom-fab-up",style:{margin:"16px"},color:"#F1D87F",onClick:I})]),_:1}),t(ne,{modelValue:r.value.open,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value.open=e),persistent:""},{default:o(()=>[t(Z,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(le,{style:{margin:"10px"}},{default:o(()=>[f(V(r.value.id?"編輯卡片":"新增卡片"),1)]),_:1}),t(ae,null,{default:o(()=>[t(B,{modelValue:s(v).value.value,"onUpdate:modelValue":l[2]||(l[2]=e=>s(v).value.value=e),label:"標題","error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"]),t(te,{modelValue:s(c).value.value,"onUpdate:modelValue":l[3]||(l[3]=e=>s(c).value.value=e),"error-messages":s(c).errorMessage.value,items:O.value,label:"分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),t(oe,{modelValue:s(m).value.value,"onUpdate:modelValue":l[4]||(l[4]=e=>s(m).value.value=e),label:"卡片說明","error-messages":s(m).errorMessage.value},null,8,["modelValue","error-messages"]),t(w,{ref_key:"fileAgent",ref:E,modelValue:a.fileRecords,"onUpdate:modelValue":l[5]||(l[5]=e=>a.fileRecords=e),"raw-model-value":a.rawFileRecords,"onUpdate:rawModelValue":l[6]||(l[6]=e=>a.rawFileRecords=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"]),t(se,{modelValue:s(g).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>s(g).value.value=e),label:"私人","error-messages":s(g).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(re,null,{default:o(()=>[t(F,{onClick:$},{default:o(()=>l[9]||(l[9]=[f(V("取消"))])),_:1}),t(F,null,{default:o(()=>l[10]||(l[10]=[f(V("送出"))])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof L=="function"&&L(_);const Fe=ce(_,[["__scopeId","data-v-180b1a60"]]);export{Fe as default};
